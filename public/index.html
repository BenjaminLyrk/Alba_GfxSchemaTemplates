<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <title>Alba GFX Skema Template Editor</title>
 <style>
  #table-container {
    overflow-x: auto;
  }

  table {
    border-collapse: collapse;
    min-width: max-content; /* Gør tabellen så bred som nødvendigt */
    font-family: sans-serif;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 4px;
    vertical-align: top;
    white-space: nowrap; /* Forhindrer linjeskift i celler */
  }

  th {
    background: #eee;
    position: sticky;
    top: 0;
    z-index: 1;
  }

  input {
    width: 100%;
    border: none;
    background: transparent;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>


</head>
<body>
  <h1>Alba GFX Skema Template Editor</h1>
  <button onclick="save()">💾 Gem ændringer</button>
  <button onclick="addRow()">➕ Tilføj ny linje i bunden</button>

  <div id="table-container"></div>

  <script>
    let data = [];

    fetch('/api/designs')
      .then(res => res.json())
      .then(json => {
        data = json;
        renderTable(json);
      });

    function renderTable(rows) {
      const keys = [...new Set(rows.flatMap(r => Object.keys(r)))];
      const table = document.createElement('table');
      const thead = table.insertRow();
      keys.forEach(k => {
        const th = document.createElement('th');
        th.textContent = k;
        thead.appendChild(th);
      });
      const thDelete = document.createElement('th');
      thDelete.textContent = 'Slet';
      thead.appendChild(thDelete);

      rows.forEach((row, i) => {
        const tr = table.insertRow();
        keys.forEach(k => {
          const td = tr.insertCell();
          const input = document.createElement('input');
          input.value = row[k] || '';
          input.oninput = e => data[i][k] = e.target.value;
          td.appendChild(input);
        });

        const deleteCell = tr.insertCell();
        const btn = document.createElement('button');
        btn.textContent = '🗑️';
        btn.onclick = () => {
          data.splice(i, 1);
          renderTable(data);
        };
        deleteCell.appendChild(btn);
      });

      document.getElementById('table-container').innerHTML = '';
      document.getElementById('table-container').appendChild(table);
    }

    function save() {
      fetch('/api/save', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      }).then(() => alert('Gemte ændringer!'));
    }

    function addRow() {
      const newRow = {
        schema: "NYT_SKEMA_NAVN",
        name: "NYT_DESIGN_NAVN",
        backgroundLoop: "",
        "--mainColor": "",
        "--bundColor": "",
        "--trompetColor": "",
        "--mainTextColor": "",
        "--trompetTextColor": "",
        "--panelColor": "",
        "--panelTextColor": "",
        "--identTextColor": "",
        "--identColor": "",
        "--fullTextColor": ""
      };
      data.push(newRow);
      renderTable(data);
    }
  </script>
</body>
</html>
